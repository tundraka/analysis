---
title: "Bank statement analysis"
output: 
  html_document:
    keep_md: true
---

```{r initialize, echo=F}
timePeriod <- '201510'
setwd('~/Documents/code/analysis')
source('bank/transactions.R')

library(ggplot2)
library(xtable)
```

## Intro

This analysis is performed for the period: `r timePeriod`

## Unknown transactions

The following are unknown transactions. This is a summary of transactions that
weren't classified and weren't part of this summary.

```{r unknowntxtable, echo=F, results='asis'}
xt <- xtable(transactions[itemid=='UNK', .(description, amount, account)])
print(xt, type='html', include.rownames=F)
```

## Sales transactions
This transactions refer to what we spent in the CCs.

```{r salestx, echo=F, results='asis'}
sales <- merge(transactions[type=='sale',
               .(description, amount=amount*-1, itemid, date, day=weekdays(date))
               ], items[,.(itemid, category, name)], by='itemid')

xt <- xtable(sales[, .(tot=sum(amount)), .(category)][order(-tot)])
print(xt, type='html', include.rownames=F)
```

### Groceries
Here we are listing the groceries transactions, the visits column indicates how
many times we went to that store, the column totvisit is just an average of the
total by visits.

```{r groceriesxt,echo=F, results='asis'}
summaryReport <- function(cat) {
    summary <- sales[category==cat, .(tot=sum(amount), visits=.N),
                     .(name)][,.(name, tot, visits,
                                 totpvisit=round(tot/visits, digits=2))][
                     order(-tot, visits)]
    xt <- xtable(summary)
    print(xt, type='html', include.rownames=F)
}

s('groceries')
```

### Restaurants

```{r restxt,echo=F, results='asis'}
summaryReport('restaurant')
```

### Shopping

```{r shoppingxt,echo=F, results='asis'}
summaryReport('shopping')
```

### Babies

```{r babiesxt,echo=F, results='asis'}
summaryReport('babies')
```

### Utilities

```{r utilitiesxt,echo=F, results='asis'}
summaryReport('utilities')
```

### Car

```{r carsxt,echo=F, results='asis'}
summaryReport('car')
```

### Other

```{r otherxt,echo=F, results='asis'}
summaryReport('other')
```
